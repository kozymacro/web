<style>
.subscription-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.7);
    z-index: 9999;
    display: none;
    opacity: 0;
    transition: opacity 0.2s ease;
}

.subscription-overlay.show {
    display: flex;
    opacity: 1;
    align-items: center;
    justify-content: center;
}

.subscription-modal {
    background: #18181b;
    border: 1px solid #2c2c30;
    border-radius: 8px;
    max-width: 420px;
    width: 90%;
    position: relative;
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
}

.subscription-close {
    position: absolute;
    top: 12px;
    right: 16px;
    background: none;
    border: none;
    color: #71717a;
    font-size: 20px;
    cursor: pointer;
    transition: color 0.2s ease;
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.subscription-close:hover {
    color: #a1a1aa;
}

.subscription-content {
    padding: 2rem;
}

.subscription-title {
    font-size: 1.5rem;
    font-weight: 600;
    color: #e4e4e7;
    margin-bottom: 0.75rem;
    text-align: center;
}

.subscription-subtitle {
    font-size: 0.95rem;
    color: #a1a1aa;
    margin-bottom: 1.5rem;
    text-align: center;
    line-height: 1.4;
}

.subscription-form-group {
    margin-bottom: 1.5rem;
}

.subscription-label {
    display: block;
    color: #a1a1aa;
    font-size: 0.9rem;
    margin-bottom: 0.5rem;
}

.subscription-input {
    width: 100%;
    padding: 0.75rem;
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid #2c2c30;
    border-radius: 6px;
    color: #e4e4e7;
    font-size: 1rem;
}

.subscription-input:focus {
    outline: none;
    border-color: #3582FB;
}

.subscription-help {
    color: #71717a;
    font-size: 0.8rem;
    margin-top: 0.5rem;
    display: block;
    white-space: pre-line;
    line-height: 1.6;
}

.subscription-btn {
    width: 100%;
    padding: 0.75rem 1.5rem;
    background: #007bff;
    color: white;
    border: none;
    border-radius: 6px;
    font-weight: 500;
    font-size: 0.95rem;
    cursor: pointer;
    transition: all 0.2s ease;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.subscription-btn:hover {
    background: #0056b3;
}

@media (max-width: 768px) {
    .subscription-modal {
        width: 95%;
        margin: 1rem;
    }

    .subscription-content {
        padding: 1.5rem;
    }
}
</style>

<div class="col-12 mt-3">
    <div class="row justify-content-center">
        <div class="col-12 col-md-6 col-lg-5">
            <a href='javascript:void(0);' class="btn btn-lg btn-outline-primary btn-block mb-2 pay-with-subscription" style="padding: 0.75rem 1rem;">
                <div style="font-size: 1.1rem; font-weight: 600; margin-bottom: 0.25rem;">
                    {{ i18n "subscriptionButton" }} <small>({{ if eq .Site.Language.Lang "tr" }}{{ i18n "subscriptionPrice" }} {{ i18n "priceSymbol" }}{{ else }}{{ i18n "priceSymbol" }}{{ i18n "subscriptionPrice" }}{{ end }}{{ if eq .Site.Language.Lang "tr" }} <small class="text-muted"><del>{{ i18n "subscriptionPriceOriginal" }} {{ i18n "priceSymbol" }}</del></small>{{ end }})</small>
                </div>
                <div style="font-size: 0.8rem; font-weight: 400; opacity: 0.8; line-height: 1.3;">
                    {{ i18n "subscriptionButtonSubtext" }}
                </div>
            </a>
        </div>
    </div>
</div>

<div class="subscription-overlay" id="subscriptionModal">
    <div class="subscription-modal">
        <button class="subscription-close" onclick="closeSubscriptionModal()">Ã—</button>

        <div class="subscription-content">
            <h2 class="subscription-title">
                {{ i18n "subscriptionModalTitle" }}
            </h2>

            <p class="subscription-subtitle">
                {{ i18n "subscriptionModalDescription" }}
            </p>

            <div class="subscription-form-group">
                <label class="subscription-label" for="seatCountInput">{{ i18n "seatCountLabel" }}</label>
                <input type="number" class="subscription-input" id="seatCountInput" min="1" max="100" value="1">
                <small class="subscription-help">{{ i18n "subscriptionQuantityHelp" }}</small>
            </div>

            <button type="button" class="subscription-btn" id="confirmSubscription">
                <span>{{ i18n "subscriptionStart" }}</span>
                <span>
                    <span id="buttonPriceOriginal" style="text-decoration: line-through; opacity: 0.6; margin-right: 0.5rem; display: none;"></span>
                    <span id="buttonPrice">{{ i18n "subscriptionPrice" }} {{ i18n "priceSymbol" }}</span>
                </span>
            </button>
        </div>
    </div>
</div>

<script>
function showSubscriptionModal() {
    const modal = document.getElementById('subscriptionModal');
    modal.classList.add('show');
    document.body.style.overflow = 'hidden';
}

function closeSubscriptionModal() {
    const modal = document.getElementById('subscriptionModal');
    modal.classList.remove('show');
    document.body.style.overflow = '';
}

document.getElementById('subscriptionModal').addEventListener('click', function(e) {
    if (e.target === this) {
        closeSubscriptionModal();
    }
});

document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
        closeSubscriptionModal();
    }
});

function updateSubscriptionPrice() {
    const seatCountInput = document.getElementById('seatCountInput');
    const seatCount = parseInt(seatCountInput.value) || 1;
    const priceData = document.getElementById('pay-with-subscription-price-id');

    const basePrice = parseFloat(priceData.getAttribute('data-base-price'));
    const tier1Count = parseInt(priceData.getAttribute('data-tier1-count'));
    const tier1Price = parseFloat(priceData.getAttribute('data-tier1-price'));
    const tier2Count = parseInt(priceData.getAttribute('data-tier2-count'));
    const tier2Price = parseFloat(priceData.getAttribute('data-tier2-price'));

    let pricePerSeat;
    if (seatCount >= tier2Count) {
        pricePerSeat = tier2Price;
    } else if (seatCount >= tier1Count) {
        pricePerSeat = tier1Price;
    } else {
        pricePerSeat = basePrice;
    }

    const totalPrice = seatCount * pricePerSeat;
    const baseTotalPrice = seatCount * basePrice;
    const symbol = '{{ i18n "priceSymbol" }}';
    const lang = priceData.getAttribute('data-lang');

    if (lang === 'tr') {
        document.getElementById('buttonPrice').textContent = totalPrice + ' ' + symbol;
    } else {
        document.getElementById('buttonPrice').textContent = symbol + totalPrice;
    }

    const originalPriceElement = document.getElementById('buttonPriceOriginal');
    if (pricePerSeat < basePrice) {
        if (lang === 'tr') {
            originalPriceElement.textContent = baseTotalPrice + ' ' + symbol;
        } else {
            originalPriceElement.textContent = symbol + baseTotalPrice;
        }
        originalPriceElement.style.display = 'inline';
    } else {
        originalPriceElement.style.display = 'none';
    }
}

document.getElementById('seatCountInput').addEventListener('input', updateSubscriptionPrice);
</script>

<input type="hidden" id="pay-with-subscription-price-id" name="pay-with-subscription-price-id"
       data-lang="{{ .Lang }}"
       data-base-price="{{ i18n "subscriptionPrice" }}"
       data-tier1-count="4"
       data-tier1-price="{{ i18n "subscriptionTier1Price" }}"
       data-tier2-count="8"
       data-tier2-price="{{ i18n "subscriptionTier2Price" }}">

{{ if ne .Site.Language.Lang "tr" }}
    <input type="hidden" id="pay-with-subscription-price-id-eur" name="pay-with-subscription-price-id-eur" data-lang="{{ .Lang }}">
{{ end }}
